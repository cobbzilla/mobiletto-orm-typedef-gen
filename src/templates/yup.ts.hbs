{{#if disclaimer}}// {{{ disclaimer }}}{{#if header}}
{{{header}}}{{/if}}

import * as yup from "yup";{{/if}}

export const {{Name}}SchemaFields = {{{curlyOpen}}}{{#each fields}}
    {{name}}: {{#if typeIsObject}}{{ ../Name }}_{{name}}Schema{{else}}{{#if typeIsArray}}yup.array().of(yup.{{valueType}}{{else}}yup.{{type}}{{/if}}(){{#if typeIsString}}.trim().transform(v => v === '' ? undefined : v){{/if}}{{#if isEnum}}
        {{arrayIndent}}.oneOf({{{enumValues}}}, '{{fullName}}_enum'){{/if}}{{#if minValue}}
        {{arrayIndent}}.min({{minValue}}, '{{fullName}}_minValue'){{/if}}{{#if maxValue}}
        {{arrayIndent}}.max({{maxValue}}, '{{fullName}}_maxValue'){{/if}}{{#if min}}
        {{arrayIndent}}.min({{min}}, '{{fullName}}_min'){{/if}}{{#if max}}
        {{arrayIndent}}.max({{max}}, '{{fullName}}_max'){{/if}}{{#if regex}}
        {{arrayIndent}}.matches({{{regexValue}}}, '{{fullName}}_regex'){{/if}}
        {{arrayIndent}}.typeError('{{fullName}}_invalid'){{#if typeIsArray}})
        .typeError('{{fullName}}_invalid'){{/if}}{{/if}}{{#if required}}
        .required('{{fullName}}_required'){{else}}
        .notRequired(){{/if}}{{#if default}}
        .default({{{defaultValue}}}){{/if}}{{#if test}}
        .test({
            name: "{{test.message}}",
            message: '{{fullName}}_{{test.message}}',
            skipAbsent: true,
            test(value{{#if ../typescript}}: string | number | boolean | null | undefined{{/if}}, ctx) {
                const t = {{{testCode}}};
                return typeof value === "undefined" || value == null || t({ ...ctx.parent });
            }
        }){{/if}}{{#if hasWhen}}
        .when([{{{whenFieldNamesQuoted}}}], {
            is: ({{#if ../typescript}}{{whenFieldSignature}}{{else}}{{whenFieldNames}}{{/if}}) => {
                const w = {{{whenCode}}};
                const v{{#if ../typescript}}: Record<string, unknown>{{/if}} = { {{whenFieldNames}} };
                return w(v);
            },
            then: (schema) => schema.required('{{fullName}}_required'),
            otherwise: (schema) => schema.notRequired(),
        }){{/if}},{{/each}}
};

export const {{Name}}Schema = yup.object({{Name}}SchemaFields);
